<?xml version="1.0" encoding="UTF-8" ?>
<odoo>  
    <template id="report_pe_guide_remission_local_document">
        <t t-call="dv_l10n_pe_edi_stock_template.external_layout_guide_remission_local_A4">
            <t t-set="o" t-value="o.with_context(lang=lang)"/>
            <div t-attf-class="{{'o_report_layout_background' if o.company_id.layout_background in ['Geometric', 'Custom'] else ''}}"
                 t-attf-style="background-image: url({{ 'data:image/png;base64,%s' % o.company_id.layout_background_image.decode('utf-8') if o.company_id.layout_background_image and o.company_id.layout_background == 'Custom' else '/base/static/img/bg_background_template.jpg' if o.company_id.layout_background == 'Geometric' else ''}}); background-size: cover; background-position: center;"
                 t-att-data-oe-model="o and o._name"
                 t-att-data-oe-id="o and o.id">
                <!-- Encabezado -->
                <div class="container" style="font-size: 12px; display: flex; align-items: center;">
                    <div class="row">
                        <div class="text-center" style="width: 30%; max-width: 30%; flex-shrink: 0;">
                            <img t-if="o.company_id.logo" t-att-src="image_data_uri(o.company_id.logo)" style="max-width: 100%;"/>
                            <div class="row">
                                <!-- <span class="fw-bold" style="font-size: 16px;" t-esc="o.company_id.name"/> -->
                            </div>
                        </div>
                        <div style="width: 36%; text-align: center; overflow-wrap: break-word; word-wrap: break-word; display: flex; align-items: center;">
                            <!-- <div>
                                <span class="fw-bold" style="font-size: 16px;" t-esc="o.company_id.name"/>
                            </div> -->
                            <div>
                                <span t-esc="o.company_id.report_header"/>
                            </div>
                            <!-- <div>
                                <span t-esc="o.company_id.street"/>
                            </div>
                            <div>Movil:
                                <span t-esc="o.company_id.mobile"/>
                            </div>
                            <div>
                                <span t-esc="o.company_id.partner_id.website"/>
                            </div> -->
                        </div>
                        <div style="width: 2%">
                        </div>
                        <div class="border boder-light fw-bold text-center" style="width: 32%; border-radius: 10px;">
                            <p>RUC:
                                <span t-esc="o.company_id.vat"/>
                            </p>
                            <p style="font-size: 16px;">Guía de Remisión Electrónica</p>
                            <p>Nro.
                                <span t-esc="o.l10n_latam_document_number"/>
                            </p>
                        </div>
                    </div>
                    <!-- <div class="row"> -->
                        <div>
                            <span t-esc="o.company_id.street"/>-
                            <span t-esc="o.company_id.partner_id.l10n_pe_district.name"/>-
                            <span t-esc="o.company_id.city"/>-
                            <span t-esc="o.company_id.state_id.name"/>
                        </div>
                    <!-- </div> -->
                    <!-- <div class="row"> -->
                        <div>
                            Telf.:&#160;&#160; <span t-esc="o.company_id.phone">Phone</span>&#160;&#160;&#160;
                            Cel.:&#160;&#160; <span t-esc="o.company_id.mobile">Mobile</span>
                        </div>
                    <!-- </div> -->
                    <div class="row" >
                        <div style="width: 40%;">
                        <span t-esc="o.company_id.partner_id.website"/>
                        </div>
                        <div style="width: 40%;">
                            Correo: <span t-esc="o.company_id.email"/>
                        </div>
                    </div>
                </div>
                <!-- Contenido -->
                <div class="container">
                    <br/>
                    <!-- Datos de inicio del traslado -->
                    <div class="border border-secondary p-2" style="border-radius: 11px; font-size: 12px; margin-top: 5px;">
                        <table class="table table-borderless">
                            <tbody>
                                <tr>
                                    <td class="fw-bold p-0" width="20%">Fecha de Emisión:</td>
                                    <td class="p-0" width="14%" style="font-weight: normal; font-size: smaller;">
                                        <span t-field="o.date_done" t-options='{"format": "dd / MM / yyyy"}'/>
                                    </td>
                                    <td class="fw-bold p-0" width="22%">Motivo de Traslado:</td>
                                    <td class="p-0" width="14%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.get_reason_for_transfer_label()"/>
                                    </td>
                                    <td class="fw-bold p-0" width="16%">Peso Bruto:</td>
                                    <td class="p-0" width="14%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.weight"/>&#160;<t t-esc="o.weight_uom_name"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="fw-bold p-0">Fecha Inicio Traslado:</td>
                                    <td class="p-0" style="font-weight: normal; font-size: smaller;">
                                        <span t-field="o.l10n_pe_edi_departure_start_date" t-options='{"format": "dd / MM / yyyy"}'/>
                                    </td>
                                    <td class="fw-bold p-0">Modalidad de Transporte:</td>
                                    <td class="p-0" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.get_transport_type_label()"/>
                                    </td>
                                    <td class="fw-bold p-0">Cantidad Productos:</td>
                                    <td class="p-0" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="int(sum(move.quantity for move in o.move_ids))"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="fw-bold p-0">Doc.Relacionado:</td>
                                    <td class="p-0" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.l10n_pe_edi_document_number"/>
                                    </td>
                                    <td class="fw-bold p-0">Orden de Compra:</td>
                                    <td class="p-0" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.orden_compra"/>
                                    </td>
                                    <td class="fw-bold p-0"></td>
                                    <td class="p-0"></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br/>
                    <!-- Datos del destinatario -->
                    <div class="border border-secondary p-2" style="border-radius: 11px; font-size: 12px;">
                        <!-- <div colspan="3" style="padding:5px;" >
                            <b>DATOS DEL DESTINATARIO</b>
                        </div> -->
                        <table class="table table-borderless">
                            <tbody>
                                <tr>
                                    <td class="fw-bold p-0" width="10%">Razon Social:</td>
                                    <td class="p-0" width="35%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.partner_id.name"/>
                                    </td>
                                    <td class="fw-bold p-0" width="10%">P. Partida:</td>
                                    <td class="p-0" width="45%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.company_id.street"/>&#160;
                                            <span t-esc="o.company_id.street2"/> -
                                            <span t-esc="o.company_id.partner_id.l10n_pe_district.name"/> -
                                            <span t-esc="o.company_id.city"/> -
                                            <span t-esc="o.company_id.state_id.name"/> - 
                                            <span t-esc="o.company_id.zip"/>
                                    </td>
                                </tr>
                                <tr>
                                    <td class="fw-bold p-0" width="10%">RUC:</td>
                                    <td class="p-0" width="35%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.partner_id.vat"/>
                                    </td>
                                    <td class="fw-bold p-0" width="10%">P. Llegada:</td>
                                    <td class="p-0" width="45%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.partner_id.street"/>&#160;
                                            <span t-esc="o.partner_id.l10n_pe_district.name"/> -
                                            <span t-esc="o.partner_id.city"/> -
                                            <span t-esc="o.partner_id.state_id.name"/> -
                                            <span t-esc="o.partner_id.zip"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br/>
                    <!-- Datos del transportista -->
                    <div class="border border-secondary p-2" style="border-radius: 11px; font-size: 12px;">
                        <table class="table table-borderless">
                            <tbody>
                                <tr>
                                    <td class="fw-bold p-0" width="20%">Razon Social:</td>
                                    <td class="p-0" width="35%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.l10n_pe_edi_operator_id.name"/>
                                    </td>
                                    <td class="fw-bold p-0" width="20%">RUC/DNI:</td>
                                    <td class="p-0" width="14%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.l10n_pe_edi_operator_id.vat"/>
                                    </td>
                                </tr>
                                <tr t-if="o.l10n_pe_edi_transport_type == '02'">
                                    <td class="fw-bold p-0" width="20%">Nombre de la Unidad:</td>
                                    <td class="p-0" width="35%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.l10n_pe_edi_vehicle_id.name"/>
                                    </td>
                                    <td class="fw-bold p-0" width="20%">Placa:</td>
                                    <td class="p-0" width="14%" style="font-weight: normal; font-size: smaller;">
                                        <t t-esc="o.l10n_pe_edi_vehicle_id.license_plate"/>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    <br/>
                    <!-- Tabla de contenido  -->   
                    <div colspan="3" style="padding:5px; font-size: 12px;" >
                        <b>INFORMACIÓN DE BIENES TRASLADADOS:</b>
                    </div>
                    <table class="table border-secondary text-center" name="stock_move_table" style="font-size: 12px;">
                        <tr style="color: #111827; background-color: #e7e9ed;">
                            <th width="5%">Item</th>
                            <th width="7%">Cant.</th>
                            <th width="9%">Unid.Med.</th>
                            <th width="79%">Descripción</th>
                        </tr>
                        <t t-set="row_num" t-value="0"/>
                        <t t-set="lines" t-value="o.move_ids.filtered(lambda x: x.product_uom_qty)"/>
                        <tr t-foreach="lines" t-as="move" style="background-color: {{'#a1a1a1' if counter % 2 == 0 else '#ffffff'}};">
                            <t t-set="row_num" t-value="row_num + 1"/>
                            <td>
                                <t t-esc="row_num"/>
                            </td>
                            <td>
                                <span t-field="move.quantity"/>
                            </td>
                            <td>
                                <span t-field="move.product_id.uom_id"/>
                            </td> 
                            <td>
                                <span t-field="move.product_id.name"/>
                            </td>
                        </tr>  
                    </table>
                    <br/>
                    <div class="row" style="display: flex; align-items: flex-start; justify-content: space-between;">
                        <div style="width: 72%;">
                            <!-- Clausula -->
                            <div class="border border-secondary p-1" style="width: 95%; font-size: 12px;">
                                <span t-field="o.company_id.report_footer"/> 
                            </div>
                        </div>
                        <div style="width: 28%; display: flex; align-items: flex-end;">
                            <!-- Recibí Conforme -->
                            <div class="border border-secondary p-2" style="width:100%; height:auto;border-radius:11px;border:1px solid #000000;">
                                <table class="table table-borderless" >
                                    <thead style="font-size: 14px;">
                                        <tr>
                                            <th class="text-center"  style="padding: 5px;">
                                            <b><u>RECIBI CONFORME</u></b>
                                            </th>
                                        </tr>
                                    </thead>  
                                </table>
                                <br/><br/><br/><br/>
                                <table class="table table-borderless"  >
                                    <thead style="font-size: 14px;">
                                        <tr>
                                            <th class="text-center"  style="padding: 5px;">
                                            <b>CLIENTE</b>
                                            </th>
                                        </tr>
                                    </thead>  
                                </table>
                            </div>
                        </div>
                    </div>
                    <!-- Observaciones -->
                    <div style="width: 60%;">
                        <div colspan="3" style="padding:5px; font-size: 12px;" >
                            <b>Observaciones:</b>
                        </div>
                        <div t-if="o.l10n_pe_edi_observation" style="border:padding: 5px; font-size: 12px;">
                            <t t-esc="o.l10n_pe_edi_observation"/>
                        </div>
                    </div>
                </div>
            </div>            
        </t>
    </template>

   
    <template id="report_pe_guide_remission_local">
        <t t-call="web.html_container">
            <t t-foreach="docs" t-as="o">
                    <t t-call="dv_l10n_pe_edi_stock_template.report_pe_guide_remission_local_document" t-lang="o.partner_id.lang"/>
            </t>
        </t>
    </template>


    <record id="action_resume_guide_report" model="ir.actions.report">
        <field name="name">Guia de Remisión</field>
        <field name="model">stock.picking</field>
        <field name="report_type">qweb-pdf</field>
        <field name="report_name">dv_l10n_pe_edi_stock_template.report_pe_guide_remission_local</field>
        <field name="report_file">dv_l10n_pe_edi_stock_template.report_pe_guide_remission_local</field>
        <field name="print_report_name">(object.l10n_latam_document_number)</field>
        <field name="binding_model_id" ref="stock.model_stock_picking"/>
        <field name="binding_type">report</field>
    </record>

    <!-- Formato A4 para guia de remisión -->
    <record id="GR_invoice_format" model="report.paperformat">
        <field name="name">A4-GR</field>
        <field name="default" eval="True" />
        <field name="format">A4</field>
        <field name="orientation">Portrait</field>
        <field name="margin_top">5.00</field>
        <field name="margin_bottom">5.00</field>
        <field name="margin_left">7.0</field>
        <field name="margin_right">7.0</field>
        <field name="header_line" eval="False" />
        <field name="header_spacing">20</field>
        <field name="dpi">90</field>
    </record>
</odoo>
