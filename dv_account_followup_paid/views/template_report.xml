<?xml version='1.0' encoding='utf-8'?>
<odoo>
  <template id="report_followup_paid_pdf_template">
    <t t-call="web.html_container">
      <meta charset="UTF-8"/>
        <!--Encabezado-->
        <div style="background-color: #D3D3D3; padding: 10px; margin-bottom: 20px;">
            <div style="display: flex; justify-content: space-between; align-items: center;">
                <!-- Título centrado -->
                <div style="text-align: center; flex-grow: 1;">
                    <h2 style="margin: 0;">Reporte de Cobranza Efectiva</h2>
                </div>
                <!-- Datos de la compañía a la izquierda -->
                <div style="text-align: left;">
                    <p style="margin: 0;"><t t-esc="docs.env.company.name"/></p>
                    <p style="margin: 0;"><t t-esc="docs.env.company.country_id.name"/></p>
                    <p style="margin: 0;"><t t-esc="docs.env.company.vat"/></p>
                </div>
            </div>
        </div>


        <!-- Inicializar totales generales -->
        <t t-set="total_usd_general" t-value="0.0"/>
        <t t-set="total_pen_general" t-value="0.0"/>
        <div class="container">
            <t t-foreach="docs_" t-as="group">
                <h3><t t-esc="group['key']"/></h3> <!-- Encabezado para cada grupo -->
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <thead>
                        <tr style="background-color: #D3D3D3; border-bottom: 1px solid #ddd;">
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Fecha Emisión</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">N° Documento</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Cliente</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Fecha de Pago</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Vendedor</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Monto en $</th>
                            <th style="border: 1px solid #ddd; padding: 8px; text-align: left;">Monto en S/</th>
                        </tr>
                    </thead>
                    <tbody>
                        <tr t-foreach="sorted(group['lines'], key=lambda l: l['account_payment_date'], reverse=True)" t-as="line">
                            <td style="border: 1px solid #ddd; padding: 8px;"><t t-esc="line['date'].strftime('%d/%m/%Y') if line['date'] else ''"/></td>
                            <td style="border: 1px solid #ddd; padding: 8px;"><t t-esc="line['document_number']"/></td>
                            <td style="border: 1px solid #ddd; padding: 8px;"><t t-esc="line['partner_id'][1] if line['partner_id'] else ''"/></td>
                            <td style="border: 1px solid #ddd; padding: 8px;"><t t-esc="line['account_payment_date'].strftime('%d/%m/%Y') if line['account_payment_date'] else ''"/></td>
                            <td style="border: 1px solid #ddd; padding: 8px;"><t t-esc="line['seller_account'][1] if line['seller_account'] else ''"/></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">$ <t t-esc="line['amount_no_sign_usd']"/></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">S/ <t t-esc="line['amount_no_sign_pen']"/></td>
                        </tr>
                    </tbody>
                </table>
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <tfoot>
                        <tr>
                            <td style="padding: 8px; width: 16%;"></td>
                            <td style="padding: 8px; width: 16%;"></td>
                            <td style="padding: 8px; width: 16%;"></td>
                            <td style="padding: 8px; width: 16%;"></td>
                            <td style="background-color: #D3D3D3 border: 1px solid #ddd; padding: 8px; text-align: right; width: 12%;">Total</td>
                            <td style="border: 1px solid #ddd; padding: 8px; width: 12%;">$ <t t-esc="round(sum(line['amount_no_sign_usd'] for line in group['lines']), 2)"/></td>
                            <td style="border: 1px solid #ddd; padding: 8px; width: 12%;">S/ <t t-esc="round(sum(line['amount_no_sign_pen'] for line in group['lines']), 2)"/></td>
                        </tr>
                        <t t-set="total_usd_general" t-value="total_usd_general + round(sum(line['amount_no_sign_usd'] for line in group['lines']), 2)"/>
                        <t t-set="total_pen_general" t-value="total_pen_general + round(sum(line['amount_no_sign_pen'] for line in group['lines']), 2)"/>
                    </tfoot>
                </table>
            </t>
            <br/>
            <br/>
            <br/>
            <t t-if="group['key'].startswith('Cliente') or group['key'].startswith('Vendedor')">
                <table style="width: 100%; border-collapse: collapse; margin-bottom: 20px;">
                    <tfoot>
                        <tr>
                            <!-- Columna vacía (1) -->
                            <td style="padding: 8px; width: 14.29%;"></td>
                            <!-- Columna vacía (2) -->
                            <td style="padding: 8px; width: 14.29%;"></td>
                            <!-- Columna vacía (3) -->
                            <td style="padding: 8px; width: 14.29%;"></td>
                            <!-- Columna vacía (4) -->
                            <td style="padding: 8px; width: 14.29%;"></td>
                            <td style="background-color: #D3D3D3; border: 1px solid #ddd; padding: 8px; text-align: right;"><b>Totales Generales</b></td>
                            <td style="border: 1px solid #ddd; padding: 8px;">
                                <b><t t-esc="'$ ' + '%.2f' % total_usd_general"/></b>
                            </td>
                            <td style="border: 1px solid #ddd; padding: 8px;">
                                <b><t t-esc="'S/ ' + '%.2f' % total_pen_general"/></b>
                            </td>
                        </tr>
                    </tfoot>
                </table>
            </t>
        </div>
    </t>
  </template>
</odoo>